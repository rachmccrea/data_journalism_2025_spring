---
title: "data_analysis"
author: "Rachel McCrea"
date: "2025-04-25"
output: html_document
---
```{r load-packages}
options(scipen=999)
library(tidyverse)  
library(knitr)      
library(lubridate) 
library(janitor)
library(ggplot2)
library(ggrepel)
```

```{r}
detail_sod <- read_csv("detail_sod.csv")
```
#fixing dates
```{r}
detail_sod <- detail_sod %>% 
  mutate(TRANSACTION_DATE=dmy(TRANSACTION_DATE))
```
```{r}
 detail_sod <- detail_sod %>% 
  mutate(PERFORM_START_DT=dmy(PERFORM_START_DT))
```
```{r}
detail_sod <- detail_sod %>% 
  mutate(PERFORM_END_DT=dmy(PERFORM_END_DT))
```
```{r}
write_csv(detail_sod, "detail_sod_clean.csv")
```


```{r}
detail_sod_clean <- read_csv("detail_sod_clean.csv")

glimpse(detail_sod_clean)
```
129,843 rows, 18 columns including dates of transactions, which office spent the money, the description of the transaction, and the amount. 
Limitations/flaws: No party column, which would have been handy if we wanted to look at differences in spending between parties. I bet it's also hard to group by "description" because there are so many different kinds of spending listed, and "legislative planning food and beverage" is different from "food and beverage". The limited timeframe could also be an issue. 

```{r}
summary_sod <- read_csv("summary_sod.csv")

glimpse(summary_sod)
```
6676 rows and five columns: organization, program, description, year-to-date amount, and quarter-to-date amount. 
Similar limitations/flaws to the detailed one: timeframe, lots of different categories for "description," no party identifier. I was also seeing some negative numbers in the amounts columns which is weird. 


Rachel
QUESTION: HOW DOES SPENDING VARY AMONG REPRESENTATIVES?
I've got a bar chart of the highest and lowest spending reps, some summary stats, and a very rough draft of a normal distribution graphic. 
Findings: spending varies significantly among representatives, with some spending well over 6 million and some spending under 500K. Most of the spending was somewhere between 4 and 6 million dollars. The highest spender was apparently the governor of Puerto Rico and the lowest spender was a GOP rep from Wisconsin. 

```{r}

#READING IN THE DATA, GROUP_BY AND SUMMARIZE

summary_sod <- read_csv("summary_sod.csv")

grouped_by_org <- summary_sod %>% 
  group_by(ORGANIZATION) %>% 
  summarize(sum = sum(YTD_AMOUNT)) %>% 
  arrange(desc(sum))

grouped_by_org %>% 
  clean_names()

#FILTERING FOR THE HIGHEST AND LOWEST SPENDERS

highest_lowest_spenders <- grouped_by_org %>% 
  filter(ORGANIZATION %in% c('2024 HON. JENNIFFER GONZALEZ-COLON','2024 HON. ALEXANDER X. MOONEY','2024 HON. MATT CARTWRIGHT','2024 HON. JEFFERSON VAN DREW','2024 HON. ADAM B. SCHIFF','2024 HON. TONY WIED','2024 HON. 3RD DISTRICT OF NEW YORK','2024 HON. ERICA LEE CARTER','2024 HON. LAMONICA MCIVER','2024 HON. BRIAN HIGGINS'))

#mira helped figure out the filtering using the c() stuff!

#PUTTING TOGETHER THE BAR CHART

#I couldn't figure out how to get the organization names to go at an angle instead of overlapping, so I asked chat. 
#here's what I had before (mira was helping me with the element_text but it didn't work)
#highest_lowest_spenders %>% 
 # ggplot() + 
 # geom_bar(aes(x = ORGANIZATION, weight = sum)) +
 # theme(
   # element_text(angle = 45)) 
#and here's what chat gave me: 
#highest_lowest_spenders %>% 
 # ggplot() + 
 # geom_bar(aes(x = ORGANIZATION, weight = sum)) +
 # theme(
   # axis.text.x = element_text(angle = 45, hjust = 1)
 # )

#What I ended up with: 
highest_lowest_spenders %>% 
  ggplot() + 
  geom_bar(aes(x = ORGANIZATION, weight = sum)) +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  labs(
    title="Highest vs. Lowest-Spending Represenatives", 
    x="Representative Offices",
    y="Spending"
  )


#SUMMARY STATS FOR ALL THE REPS 

#went into excel, deleted everything that wasn't a rep's office, including leadership offices. i feel like their budgets might be huge, but we can come back and look at that once we look at normal members of the house.
#ended up making a new excel spreadsheet because the old one had a bunch of empty rows at the bottom when I read it back in. 
write_csv(grouped_by_org, file = "grouped_by_org.csv")
grouped_by_reps <- read_csv("grouped_by_reps.csv")

grouped_by_reps %>% 
  summarize(mean = mean(sum), median = median(sum), max = max(sum), min = min(sum), sd = sd(sum))
#got the summary stats! not sure about the standard deviation, though. 


#NORMAL DISTRIBUTION

#first try: 
grouped_by_reps %>% 
  ggplot()+
  geom_bar(aes(x = ORGANIZATION, weight = sum))
#YIKES 

#time to search thru assignments to find normal distribution ggplot
#can't find it. asking terpai how to do a normal distribution in ggplot.
#terpai gave me a bunch of stuff that didn't work. gave it the code I have and it pointed me in the right direction -- I was using organization instead of count
#here's the code terp AI gave me, I put "sum" in for x and changed the title and x label. 
# Example assuming 'value' is the numeric variable you want to plot
grouped_by_reps %>% 
  ggplot(aes(x = sum)) +  # Replace 'value' with your numeric variable
  geom_histogram(aes(y =..density..), bins = 30, fill = "lightblue", color = "black") +
  stat_function(fun = dnorm, args = list(mean = mean(grouped_by_reps$value, na.rm = TRUE), 
                                          sd = sd(grouped_by_reps$value, na.rm = TRUE)), 
                color = "red", size = 1) +
  labs(title = "Representative Spending", x = "$", y = "Density") +
  theme_minimal()
#YOOOO THANKS CHAT 



```




